---
id: L-104
date: 2023.11.01
category: TUTORIAL
title: 'Reverse Engineering Bluetooth LE Packets'
readTime: 12 MIN
preview: 'A deep dive into sniffing and decoding BLE traffic from smart home devices using Wireshark and a nRF52840 dongle.'
tags:
  - ble
  - reverse-engineering
  - tutorial
---
# Reverse Engineering Bluetooth LE Packets

## Tools Required

- **nRF52840 Dongle** — for BLE packet sniffing
- **Wireshark** — with Nordic BLE sniffer plugin
- **Python 3** — for packet analysis scripts
- A target BLE device (I used a smart light bulb)

## Step 1: Setting Up the Sniffer

```bash
# Flash the sniffer firmware
nrfutil dfu usb-serial -pkg sniffer_nrf52840dongle.zip -p COM3

# Start Wireshark with the nRF sniffer interface
wireshark -i nRF_Sniffer -k
```

## Step 2: Capturing Advertisements

BLE devices broadcast **advertisement packets** on channels 37, 38, 39. These contain:
- Device name
- Service UUIDs
- Manufacturer-specific data

## Step 3: Decoding the Protocol

After pairing, I captured the GATT writes that control the bulb:

```
Handle: 0x0025
Value:  7e 04 04 ff 00 00 00 00 ef
        │  │  │  │  │  │
        │  │  │  R  G  B
        │  │  └─ Command: Set Color
        │  └──── Length
        └─────── Header
```

## Step 4: Building a Custom Controller

```python
import asyncio
from bleak import BleakClient

async def set_color(address, r, g, b):
    async with BleakClient(address) as client:
        cmd = bytes([0x7e, 0x04, 0x04, r, g, b, 0x00, 0x00, 0xef])
        await client.write_gatt_char("0000fff3-...", cmd)

asyncio.run(set_color("AA:BB:CC:DD:EE:FF", 0, 255, 255))
```

> Now I control all my lights from a Python script. The smart home app has been deleted.
